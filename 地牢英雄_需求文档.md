# 《地牢英雄：终端历险》需求规格说明书 (V1.0)

**文档状态：** 草案\
**目标版本：** V1.0 (最小可行产品 - MVP)\
**编写日期：** 2026年02月05日\
**编写目的：** 定义《地牢英雄：终端历险》文字Roguelike游戏V1.0版本的核心功能、规则、界面及技术实现要求，为开发提供明确指导，确保项目聚焦、可控，避免范围蔓延和复杂Bug。

## 1. 项目概述与目标

- **游戏类型：** 回合制、基于终端(Console)或极简图形界面的Roguelike地牢爬行游戏。
- **核心体验：** 玩家扮演英雄在随机生成的地牢中探索、战斗、收集物品，追求深入更底层或达成特定目标。角色永久死亡（Permadeath），每次游戏都是全新体验。
- **核心特色：**
  - **ASCII艺术呈现：** 完全使用字符(`@`, `g`, `D`, `#`, `.`, `!`等)在终端或简单图形窗口中展现游戏世界、角色、物品和效果。
  - **程序生成：** 地牢楼层、房间、走廊、物品、敌人、事件均由算法随机生成，保证每次游戏的独特性。
  - **回合制策略：** 玩家与敌人轮流行动，需谨慎规划移动、攻击和使用物品。
  - **角色成长：** 通过击败敌人获取经验升级，提升属性，学习/强化技能。
  - **永久死亡与传承：** 角色死亡后游戏结束，但可能解锁新内容或提供少量传承优势（V1.0 暂不实现传承）。
- **MVP目标：**
  - 实现一个完整、可玩的核心循环（生成地牢 -&gt; 探索 -&gt; 战斗 -&gt; 成长 -&gt; 死亡/胜利）。
  - 提供基础的角色系统、物品系统、战斗系统和地牢生成。
  - 确保游戏稳定运行，关键逻辑有基本测试。
  - 开发周期控制在1-2周内完成核心原型。

## 2. 核心功能需求 (V1.0)

### 2.1 游戏世界与地牢

- **地牢结构：**
  - 由多个楼层组成（V1.0 实现 3-5 层）。
  - 每层由房间（矩形）和连接房间的走廊构成。
  - 使用程序化生成算法（如“随机房间+德劳内三角剖分生成走廊”或“洞穴生成算法”）。
  - **地图表示：**
    - `#`：墙壁 (Wall)
    - `.`：地板 (Floor)
    - `>`：通往下一层的楼梯 (Stairs Down)
    - `<`：通往上一层的楼梯 (Stairs Up, V1.0 可能仅顶层有)
- **视野与探索：**
  - 采用“视锥”或“方形范围”视野（如玩家周围8格可见）。
  - 已探索但当前不可见的区域以` `(空格)或暗淡字符显示。
  - 未探索区域完全隐藏（显示为` `或特定字符如`?`）。

### 2.2 玩家角色 (Hero `@`)

- **基础属性：**
  - `HP`：生命值 (Health Points)，为0时死亡。
  - `ATK`：攻击力 (Attack)，影响物理伤害。
  - `DEF`：防御力 (Defense)，减少受到的物理伤害。
  - `XP`：当前经验值 (Experience Points)。
  - `Level`：等级，初始为1。升级需要一定XP，升级后提升`Max HP`, `ATK`, `DEF`。
- **位置：** 在地图上的坐标 `(x, y)`。
- **物品栏：** 可携带有限数量的物品（V1.0 容量：8格）。
- **状态：** 健康、中毒（V1.0 可暂缓）、死亡。

### 2.3 非玩家角色 (NPCs - 敌人)

- **表示：** 使用不同字母表示不同敌人（如：`g` 地精 Goblin, `o` 兽人 Orc, `s` 史莱姆 Slime, `D` 龙 Dragon (Boss)）。
- **属性：** 拥有类似玩家的 `HP`, `ATK`, `DEF` 属性（数值根据类型和等级设定）。
- **行为：**
  - **基础AI：** 发现玩家后，向玩家移动并攻击。
  - **巡逻/闲置：** 未发现玩家时，在有限范围内随机移动或静止。
- **经验值：** 击败敌人后，玩家获得相应XP。

### 2.4 物品系统

- **表示：** 地图上用特定字符表示（如 `!` 药水, `?` 卷轴, `$` 金币, `/` 武器, `[` 盔甲）。
- **类型：**
  - **消耗品 (Consumable):**
    - *生命药水 (Healing Potion)*：恢复一定量HP。
    - *卷轴 (Scroll)*：V1.0 实现1-2种（如：`卷轴：火球术` - 对目标区域造成伤害；`卷轴：传送` - 随机传送）。
  - **装备 (Equipment):** V1.0 简化，拾取后直接生效（非传统装备槽）。
    - *武器 (Weapon)*：拾取后永久增加 `ATK`。
    - *盔甲 (Armor)*：拾取后永久增加 `DEF`。
  - **金币 (Gold):** 货币（V1.0 可能仅用于计分或未来商店）。
- **交互：**
  - 走到物品所在格子自动拾取（如果物品栏有空位）。
  - 使用消耗品：通过快捷键选择物品栏物品使用（如 `u` -&gt; 选择物品）。
  - 装备：拾取即生效（V1.0）。

### 2.5 战斗系统

- **回合制：** 玩家行动 -&gt; 所有可见敌人行动 -&gt; ... 循环。
- **玩家行动：**
  - **移动：** `WASD` 或方向键（`HJKL` - Vi键）移动一格。
  - **攻击：** 移动到敌人相邻格子自动攻击（方向键向敌人移动）。攻击结算：`伤害 = max(1, 玩家.ATK - 敌人.DEF)`。
  - **使用物品：** 快捷键打开物品栏(`i`)，选择物品使用(`u`)。
  - **上下楼梯：** 走到`>`或`<`位置按对应键（如 `>`）进入下一层/上一层。
  - **等待/跳过回合：** `.` 或 `5` (小键盘)。
- **敌人行动：**
  - 根据AI决定移动或攻击玩家。
  - 攻击结算同玩家攻击敌人：`伤害 = max(1, 敌人.ATK - 玩家.DEF)`。
- **死亡：** 玩家或敌人HP&lt;=0时死亡。玩家死亡游戏结束。敌人死亡消失并掉落物品/金币。

### 2.6 用户界面 (UI - 终端/极简图形)

- **主游戏区域：** 显示当前楼层的地图（ASCII字符），玩家(`@`)、敌人(字母)、物品(符号)位置。
- **状态栏：**
  - 显示玩家关键信息：`Level: X | HP: Y/Z | ATK: A | DEF: D | XP: E/F` (E当前经验，F下一级所需)。
  - 显示当前楼层：`Dungeon Level: N`。
- **消息日志：** 显示游戏事件（如“你攻击了地精(g)，造成3点伤害！”，“你喝下了生命药水，恢复5点HP”，“你发现了通往下一层的楼梯(&gt;)”）。
- **物品栏界面 (**`i` **键打开)：** 列表显示物品名称和数量（如 `1. 生命药水 x2`, `2. 火球术卷轴`）。选中物品后可`u`使用或`d`丢弃。

### 2.7 游戏流程

1. **开始游戏：** 生成角色（初始属性），生成第1层地牢（包含玩家起始位置、楼梯`>`、若干敌人、若干物品）。
2. **主循环：**
   - 渲染地图、状态栏、日志。
   - 等待玩家输入（移动、攻击、物品、楼梯等）。
   - 执行玩家动作（移动、攻击、使用物品、上下楼），更新地图和状态。
   - 处理玩家动作结果（战斗、拾取、触发事件）。
   - 所有可见敌人执行其AI（移动、攻击玩家）。
   - 处理敌人行动结果（战斗）。
   - 检查玩家是否死亡 -&gt; 游戏结束。
   - 检查玩家是否到达楼梯并触发下一层 -&gt; 生成新楼层，玩家出现在新楼层楼梯`<`旁。
3. **游戏结束：**
   - **胜利条件 (V1.0 MVP)：** 到达并进入最底层（如第5层）的楼梯（可能遇到Boss `D`）。
   - **失败条件：** 玩家HP &lt;= 0。
   - 显示结算信息（到达层数、击败敌人数、获得经验、收集金币等）和“Game Over”。

## 3. 非功能性需求

- **性能：** 在标准终端或简单图形窗口中应流畅运行（目标：&gt; 30 FPS）。
- **可玩性：**
  - 核心循环清晰有趣。
  - 随机生成保证基本可玩性和重玩价值。
  - 难度曲线初步合理（随着层数加深，敌人强度提升）。
- **稳定性：**
  - 关键逻辑（地牢生成、战斗结算、物品使用）必须进行**单元测试**。
  - 使用**异常处理**捕获预期外的错误（如地图生成失败、文件读取错误）。
  - 关键操作（状态变更、战斗、使用物品）记录详细**日志**，便于调试。
  - **防御性编程：** 检查函数输入有效性，使用断言(assertions)验证关键假设。
- **易用性：**
  - 操作指令清晰（提供`?`帮助界面，显示所有操作快捷键）。
  - 界面信息（地图、状态、日志）简洁明了。
- **可维护性与扩展性：**
  - **模块化设计：** 清晰分离模块：`GameEngine`, `DungeonGenerator`, `Entity (Player, NPC)`, `ItemSystem`, `CombatSystem`, `Renderer (ASCII/SimpleGUI)`, `InputHandler`。
  - **版本控制：** 使用Git管理代码，进行小步、频繁的提交，附带清晰注释。`.gitignore` 配置正确。
  - **配置数据：** 将可调参数（如初始玩家属性、敌人属性、物品效果、经验值表）提取到配置文件（如JSON）中，便于调整平衡性。

## 4. 技术栈建议 (选择熟悉度优先)

- **语言：**
  - **Python:** 推荐。开发速度快，库丰富。核心库：`libtcod` (专为Roguelike设计，提供高级ASCII渲染、FOV、路径查找等)，或 `curses` (基础终端图形库) + 自行实现其他逻辑。
  - **Java:** 同样可行。核心库：`AsciiPanel` (轻量级ASCII渲染)，或 `Lanterna` (更强大的终端库)。搭配标准库实现逻辑。
- **工具：**
  - **Git:** 版本控制（必须）。
  - **IDE:** PyCharm (Python), IntelliJ IDEA (Java) 或 VS Code。
  - **测试框架:** `pytest`/`unittest` (Python), JUnit (Java)。
  - **日志库:** Python `logging`, Java `java.util.logging` 或 Log4j/SLF4J。

## 5. 美术与音效 (极简原则)

- **视觉：** 完全依赖ASCII字符。可考虑使用不同颜色增强可读性（如敌人红色，玩家绿色，物品蓝色）。
- **音效：** V1.0 **强烈建议省略**以降低复杂度。后续可添加极简音效（如移动声、攻击声、拾取声），使用免费资源。

## 6. V1.0 范围界定 (严格限制)

- **包含：** 以上列出的所有核心功能需求。
- **不包含 (未来版本或可选)：**
  - 角色职业/种族选择。
  - 复杂的装备系统（多槽位、装备属性）。
  - 大量技能/法术（V1.0仅1-2个卷轴）。
  - 商店/NPC对话。
  - 传承/解锁系统。
  - 音效。
  - 图形化界面（非ASCII）。
  - 网络功能。

## 7. 防Bug开发启动清单 (开工前必做)

1. **初始化Git仓库：** `git init`，创建合理的 `.gitignore` 文件（忽略编译输出、IDE文件、临时文件等）。
2. **核心数据结构设计文档：** 用文本或注释清晰定义：
   - `Player` 类/结构体属性。
   - `NPC` 类/结构体属性。
   - `Item` 类/结构体属性（类型、效果、表示字符）。
   - `DungeonLevel` 或 `GameMap` 类/结构体（存储地图数据、实体列表、物品列表）。
3. **核心函数空测试用例：** 为以下函数创建测试文件并编写至少一个空的测试方法（先写测试名）：
   - 战斗伤害计算函数 `calculate_damage(attacker, defender)`。
   - 玩家移动有效性检查 `can_move_to(x, y)`。
   - 简单的物品使用效果函数 `use_item(item, target)` (如治疗药水)。
4. **确定并集成核心库：** 选择并成功导入 `libtcod` (Python) 或 `AsciiPanel` (Java) 等库，确保环境配置正确。
5. **“Hello Dungeon” 渲染：** 编写代码，在终端/窗口中：
   - 显示一个静态的简单房间（墙壁`#`，地板`.`）。
   - 在房间中央显示玩家 `@`。
   - 响应 `WASD` 移动玩家 `@` 并正确刷新显示（不能穿墙）。
   - 在状态栏显示 `HP: 10/10`。
   - 在日志显示 “Welcome to the Dungeon, Hero!”。
6. **基础日志配置：** 设置日志系统，至少能将错误信息记录到文件或控制台。